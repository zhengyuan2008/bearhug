# Supabase è®¾ç½®æŒ‡å—

## ğŸ“Š æ•°æ®åº“è®¾ç½®æ­¥éª¤

### 1. åœ¨Supabaseæ§åˆ¶å°åˆ›å»ºè¡¨

ç™»å½•ä½ çš„Supabaseé¡¹ç›®ï¼šhttps://szwqonkwebeukqhqpyfy.supabase.co

è¿›å…¥ **SQL Editor**ï¼Œæ‰§è¡Œ `supabase-schema.sql` æ–‡ä»¶ä¸­çš„SQLè¯­å¥ã€‚

### 2. é…ç½®APIå¯†é’¥

åœ¨ `js/supabase-config.js` ä¸­ï¼Œä½ éœ€è¦æ›¿æ¢å®Œæ•´çš„ `anonKey`ï¼š

```javascript
const SUPABASE_CONFIG = {
  url: 'https://szwqonkwebeukqhqpyfy.supabase.co',
  anonKey: 'ä½ çš„å®Œæ•´anon-key' // ä» Settings â†’ API è·å–
};
```

### 3. è·å–å®Œæ•´çš„ Anon Key

1. è¿›å…¥ Supabase é¡¹ç›®æ§åˆ¶å°
2. ç‚¹å‡»å·¦ä¾§ **Settings** â†’ **API**
3. å¤åˆ¶ **anon / public** keyï¼ˆé€šå¸¸å¾ˆé•¿ï¼Œä»¥ `eyJ` å¼€å¤´ï¼‰
4. æ›¿æ¢ `js/supabase-config.js` ä¸­çš„ `anonKey`

## ğŸ—„ï¸ æ•°æ®åº“è¡¨ç»“æ„

å·²åˆ›å»ºä»¥ä¸‹è¡¨ï¼š

1. **user_interactions** - ç”¨æˆ·äº’åŠ¨è®°å½•
   - è®°å½•ç‚¹å‡»ã€æƒ…ç»ªé€‰æ‹©ç­‰äº‹ä»¶

2. **period_records** - å§¨å¦ˆå‘¨æœŸè®°å½•
   - äº‘ç«¯åŒæ­¥å‘¨æœŸæ•°æ®

3. **survival_checkins** - ç­¾åˆ°è®°å½•
   - "æˆ‘åˆæ´»è¿‡äº†ä¸€å¤©"ç­¾åˆ°æ•°æ®

4. **warm_messages** - æ¸©æš–è¯­å½•åº“
   - å¯ä»æ•°æ®åº“åŠ¨æ€åŠ è½½æ¶ˆæ¯

5. **ai_config** - AIé…ç½®ï¼ˆé¢„ç•™ï¼‰
   - ä¸ºæœªæ¥AIåŠŸèƒ½é¢„ç•™

## ğŸ“ Row Level Security (RLS)

æ•°æ®åº“å·²å¯ç”¨RLSç­–ç•¥ï¼š
- âœ… åŒ¿åç”¨æˆ·å¯ä»¥æ’å…¥å’Œè¯»å–è‡ªå·±çš„æ•°æ®
- âœ… æ¸©æš–è¯­å½•å¯¹æ‰€æœ‰äººå¯è¯»
- âœ… æ•°æ®æŒ‰ `session_id` éš”ç¦»

## ğŸ”§ ä½¿ç”¨æ•°æ®åº“åŠŸèƒ½

åœ¨ `js/supabase-db.js` ä¸­å·²æä¾›ä»¥ä¸‹å‡½æ•°ï¼š

```javascript
// è®°å½•ç”¨æˆ·äº’åŠ¨
await logInteraction('hug', { photo_id: 'photo1' });

// ä¿å­˜å§¨å¦ˆè®°å½•åˆ°äº‘ç«¯
await savePeriodToCloud('2024-12-27');

// ä¿å­˜ç­¾åˆ°è®°å½•
await saveCheckinToCloud('2024-12-27');

// åŠ è½½æ¸©æš–æ¶ˆæ¯
const messages = await loadWarmMessages();
```

## ğŸš€ æœªæ¥æ‰©å±•

### AIé›†æˆå‡†å¤‡

åœ¨ `ai_config` è¡¨ä¸­å¯ä»¥å­˜å‚¨ï¼š
- AIæç¤ºè¯æ¨¡æ¿
- ç³»ç»ŸèƒŒæ™¯ä¿¡æ¯
- ä¸ªæ€§åŒ–é…ç½®

### æ•°æ®åˆ†æ

å¯ä»¥æŸ¥è¯¢ï¼š
- ç”¨æˆ·äº’åŠ¨é¢‘ç‡
- æƒ…ç»ªè¶‹åŠ¿åˆ†æ
- ä½¿ç”¨ä¹ æƒ¯ç»Ÿè®¡

## âš ï¸ å®‰å…¨æç¤º

- âœ… Anon key æ˜¯å…¬å¼€å¯†é’¥ï¼Œå¯ä»¥å‰ç«¯ä½¿ç”¨
- âœ… RLS ç­–ç•¥ä¿æŠ¤æ•°æ®å®‰å…¨
- âŒ ä¸è¦æäº¤çœŸå®å¯†é’¥åˆ°å…¬å¼€ä»“åº“
- âœ… ç”Ÿäº§ç¯å¢ƒå»ºè®®ä½¿ç”¨ç¯å¢ƒå˜é‡
